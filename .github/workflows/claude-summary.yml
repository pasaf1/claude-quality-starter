name: Claude Summary

on:
  push:
    branches: [ master ]      # 砖 -main   注祝 砖
    paths-ignore:
      - 'SUMMARY.md'          # 注 驻注 转转

jobs:
  summarize:
    runs-on: ubuntu-latest

    steps:
    # 1) 砖驻转 拽
    - uses: actions/checkout@v4

    # 2) 转拽转 Node (Claude CLI 专砖 npm)
    - uses: actions/setup-node@v4
      with:
        node-version: 20

    # 3) 转拽转 Claude CLI
    - run: npm install -g @anthropic-ai/claude-code

    # 4) 注转 驻转 CLAUDE_API_KEY -ENV
    - name: Load CLAUDE_API_KEY
      run: echo "CLAUDE_API_KEY=${{ secrets.CLAUDE_API_KEY }}" >> $GITHUB_ENV

    # 5) 爪专转 commit.txt 住 注状 Claude
    - name: Create summary
      run: |
        git log -1 --pretty=format:"%h - %s" > commit.txt
        git diff HEAD~1..HEAD >> commit.txt

        claude code --no-permissions . \
          --command "住 注专转 (bullet-list 拽爪专) 转 拽抓 commit.txt." \
          --input commit.txt > SUMMARY.md

    # 6) 拽 驻砖 砖 SUMMARY.md
    - name: Commit summary
      env:
        #   专转 GH_TOKEN 注爪, GitHub 转 拽 专专转-
        GITHUB_TOKEN: ${{ secrets.GH_TOKEN || github.token }}
      run: |
        git config --global user.name  "claude-bot"
        git config --global user.email "claude@example.com"
        git add SUMMARY.md
        git commit -m "docs: auto summary by Claude " || echo "No changes"
        git push

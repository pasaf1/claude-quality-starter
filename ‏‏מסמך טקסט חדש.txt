name: Claude Summary

on:
  push:
    branches: [ master ]        # 砖 -main  爪专
    paths-ignore:
      - 'SUMMARY.md'            # 砖 专 转 注爪 驻

jobs:
  summarize:
    runs-on: ubuntu-latest

    steps:
    # 1) Checkout
    - uses: actions/checkout@v4

    # 2) Setup Node  转拽 转 Claude CLI
    - uses: actions/setup-node@v4
      with:
        node-version: 20

    # 3) Install Claude CLI
    - run: npm install -g @anthropic-ai/claude-code

    # 4) Load secrets 砖转 住
    - name: Load Claude API key
      run: |
        echo "CLAUDE_API_KEY=${{ secrets.CLAUDE_API_KEY }}" >> $GITHUB_ENV

    # 5) 爪专 住 砖 注 Claude
    - name: Generate summary with Claude
      run: |
        # 拽 转  拽 专 ( diff 拽专 专砖)
        git log -1 --pretty=format:"%h - %s" > commit.txt
        git diff HEAD~1..HEAD >> commit.txt

        # 拽专 -CLI 砖转住 转  转专 注专转
        claude code --no-permissions . --command "$(cat <<'PROMPT'
        You are a release notes assistant. Summarize the changes in commit.txt in Hebrew, bullet-list, concise.
        PROMPT
        )" --input commit.txt > SUMMARY.md

    # 6) 住祝, 拽 祝 转 SUMMARY.md
    - name: Commit summary back
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN || github.token }}
      run: |
        git config --global user.name  "claude-bot"
        git config --global user.email "claude@example.com"

        git add SUMMARY.md
        git commit -m "docs: auto-summary by Claude " || echo "No changes"
        git push
